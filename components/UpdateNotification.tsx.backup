"use client"

import { useState, useEffect } from 'react'
import { X } from 'lucide-react'
import { Button } from '@/components/ui/button'
import Link from 'next/link'

interface UpdateNotificationProps {
  caseId: string
  caseTitle: string
  updateId: string
  onClose: () => void
}

export default function UpdateNotification({ caseId, caseTitle, updateId, onClose }: UpdateNotificationProps) {
  const [isVisible, setIsVisible] = useState(true)

  // Animation effect
  useEffect(() => {
    // Auto-hide after 10 seconds
    const timer = setTimeout(() => {
      handleClose()
    }, 10000)

    return () => clearTimeout(timer)
  }, [])

  const handleClose = () => {
    setIsVisible(false)
    // Wait for animation to complete
    setTimeout(() => {
      onClose()
    }, 300)
  }

  const markAsRead = async () => {
    try {
      const token = localStorage.getItem("donorToken")
      if (!token) return

      await fetch(`http://localhost:5001/api/donor/mark-update-seen/${updateId}`, {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })
    } catch (error) {
      console.error('Error marking update as read:', error)
    }
  }

  const handleViewClick = () => {
    markAsRead()
    handleClose()
  }

  if (!isVisible) return null

  return (
    <div className={`fixed bottom-4 right-4 bg-slate-800 border border-purple-500 rounded-lg shadow-lg p-4 max-w-sm w-full z-50 transition-all duration-300 ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-8'}`}>
      <div className="flex justify-between items-start">
        <div className="flex items-center">
          <span className="bg-purple-500 rounded-full w-2 h-2 mr-2 animate-pulse"></span>
          <h3 className="font-semibold text-white">New Update Available</h3>
        </div>
        <button 
          onClick={handleClose} 
          className="text-gray-400 hover:text-white transition-colors"
          aria-label="Close notification"
        >
          <X size={18} />
        </button>
      </div>
      <p className="mt-2 text-gray-300">
        There is a new update on <span className="font-semibold text-purple-300">{caseTitle}</span>
      </p>
      <div className="mt-3 flex justify-end space-x-2">
        <Button 
          variant="outline" 
          size="sm" 
          onClick={handleClose}
          className="text-xs"
        >
          Dismiss
        </Button>
        <Button 
          variant="default" 
          size="sm" 
          className="bg-purple-600 hover:bg-purple-700 text-xs"
          onClick={handleViewClick}
          asChild
        >
          <Link href={`/donor/dashboard?tab=case-updates&caseId=${caseId}`}>
            View Update
          </Link>
        </Button>
      </div>
    </div>
  )
}
